<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>거래명세표</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 10mm 10mm 10mm 10mm;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Malgun Gothic", "맑은 고딕", sans-serif;
            font-size: 9pt;
            line-height: 1.2;
        }

        .container {
            width: 100%;
            border: 1px solid #008000;
            border-collapse: collapse;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        td {
            border: 0.5px solid #000;
            padding: 2px 4px;
            vertical-align: middle;
            overflow: hidden;
            word-wrap: break-word;
        }

        /* 외곽 녹색 테두리 */
        .border-top { border-top: 1px solid #008000 !important; }
        .border-bottom { border-bottom: 1px solid #008000 !important; }
        .border-left { border-left: 1px solid #008000 !important; }
        .border-right { border-right: 1px solid #008000 !important; }

        /* 정렬 */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .vertical-center { vertical-align: middle; }

        /* 폰트 크기 */
        .font-large { font-size: 20pt; font-weight: bold; }
        .font-medium { font-size: 11pt; }
        .font-small { font-size: 9pt; }
        .font-tiny { font-size: 8pt; }

        /* 배경색 */
        .bg-light { background-color: #f5f5f5; }

        /* 헤더 영역 */
        .header-date {
            height: 30px;
            font-size: 10pt;
            text-align: center;
            vertical-align: middle;
        }

        .header-title {
            height: 40px;
            font-size: 24pt;
            font-weight: bold;
            text-align: center;
            vertical-align: middle;
            letter-spacing: 8px;
        }

        .header-type {
            text-align: center;
            vertical-align: middle;
            font-size: 9pt;
        }

        /* 공급받는자/공급자 라벨 */
        .section-label {
            writing-mode: vertical-lr;
            text-align: center;
            font-size: 11pt;
            font-weight: bold;
            letter-spacing: 2px;
            padding: 10px 2px;
        }

        /* 데이터 테이블 헤더 */
        .data-header {
            background-color: #f0f0f0;
            text-align: center;
            font-weight: bold;
            font-size: 9pt;
            height: 25px;
            vertical-align: middle;
        }

        /* 데이터 행 */
        .data-row td {
            height: 18px;
            font-size: 9pt;
        }

        /* NEGO 행 스타일 */
        .nego-row {
            color: #ff0000;
        }

        /* 합계 행 */
        .total-row {
            background-color: #ffffcc;
            font-weight: bold;
        }

        /* 고객사 정보 라벨 */
        .info-label {
            background-color: #f5f5f5;
            text-align: center;
            font-size: 8pt;
            padding: 2px;
        }

        /* 빈 행 */
        .blank-row td {
            height: 18px;
            border-left: 0.5px solid #000;
            border-right: 0.5px solid #000;
            border-top: none;
            border-bottom: none;
        }

        /* 월/일 컬럼 너비 */
        .col-month { width: 3%; }
        .col-day { width: 3%; }
        .col-item { width: 18%; }
        .col-spec { width: 15%; }
        .col-qty { width: 6%; }
        .col-price { width: 12%; }
        .col-supply { width: 14%; }
        .col-vat { width: 14%; }
        .col-note { width: 6%; }

        /* 헤더 컬럼 너비 */
        .col-small { width: 8%; }
        .col-medium { width: 12%; }
        .col-large { width: 20%; }
    </style>
</head>
<body>
    <table class="container">
        <!-- 작성일자 행 -->
        <tr>
            <td colspan="6" class="header-date border-top border-left">거 래 일 자</td>
            <td colspan="19" rowspan="2" class="header-title border-top">거  래  명  세  표</td>
            <td colspan="6" class="header-type border-top border-right">(공급받는자용)</td>
        </tr>
        <tr>
            <td colspan="6" class="text-center border-left">{{ service_date }}</td>
            <td colspan="6" class="text-center border-right"></td>
        </tr>

        <!-- 공급받는자/공급자 정보 영역 -->
        <tr>
            <td rowspan="8" class="section-label border-left">공급받는자</td>
            <td colspan="3" rowspan="2" class="info-label">상     호<br>(법인명)</td>
            <td colspan="10" rowspan="2" class="text-left">{{ customer_info.company_name }}</td>
            <td colspan="2" rowspan="2" class="text-center">귀하</td>
            <td rowspan="8" class="section-label">공 급 자</td>
            <td colspan="3" rowspan="2" class="info-label">등록번호</td>
            <td class="text-center">1</td>
            <td class="text-center">2</td>
            <td class="text-center">2</td>
            <td class="text-center">-</td>
            <td class="text-center">8</td>
            <td class="text-center">6</td>
            <td class="text-center">-</td>
            <td class="text-center">1</td>
            <td class="text-center">2</td>
            <td class="text-center">7</td>
            <td class="text-center">6</td>
            <td class="text-center border-right">0</td>
        </tr>
        <tr>
            <td class="text-center">1</td>
            <td class="text-center">2</td>
            <td class="text-center">2</td>
            <td class="text-center">-</td>
            <td class="text-center">8</td>
            <td class="text-center">6</td>
            <td class="text-center">-</td>
            <td class="text-center">1</td>
            <td class="text-center">2</td>
            <td class="text-center">7</td>
            <td class="text-center">6</td>
            <td class="text-center border-right">0</td>
        </tr>
        <tr>
            <td colspan="3" class="info-label">사 업 장</td>
            <td colspan="12" rowspan="2" class="text-left">{{ customer_info.address }}</td>
            <td colspan="3" class="info-label">상     호</td>
            <td colspan="7" rowspan="2" class="text-left">LVD Korea (유)</td>
            <td rowspan="2" class="text-center">성명</td>
            <td colspan="4" rowspan="2" class="text-center border-right">이동호</td>
        </tr>
        <tr>
            <td colspan="3" class="info-label">주     소</td>
            <td colspan="3" class="info-label">(법인명)</td>
        </tr>
        <tr>
            <td colspan="3" rowspan="2" class="info-label">전화번호</td>
            <td colspan="12" rowspan="2" class="text-left">{{ customer_info.phone }}{% if customer_info.fax %}<br>{{ customer_info.fax }}{% endif %}</td>
            <td colspan="3" class="info-label">사 업 장</td>
            <td colspan="13" rowspan="2" class="text-left border-right">인천광역시 부평구 청천동 409-7</td>
        </tr>
        <tr>
            <td colspan="3" class="info-label">주     소</td>
        </tr>
        <tr>
            <td colspan="3" rowspan="2" class="info-label">합계금액</td>
            <td colspan="12" rowspan="2" class="text-right font-medium">{{ "{:,}".format(total_amount) }}</td>
            <td colspan="3" rowspan="2" class="info-label">전   화</td>
            <td colspan="6" rowspan="2" class="text-center">050-2345-7801</td>
            <td rowspan="2" class="text-center">팩스</td>
            <td colspan="5" rowspan="2" class="text-center border-right">050-2345-7816</td>
        </tr>
        <tr></tr>

        <!-- 데이터 테이블 헤더 -->
        <tr>
            <td colspan="2" class="data-header border-left">월</td>
            <td colspan="2" class="data-header">일</td>
            <td colspan="6" class="data-header">품  목</td>
            <td colspan="5" class="data-header">규  격</td>
            <td colspan="2" class="data-header">수 량</td>
            <td colspan="5" class="data-header">단   가</td>
            <td colspan="5" class="data-header">공 급 가 액</td>
            <td colspan="5" class="data-header">세  액</td>
            <td colspan="2" class="data-header border-right">비고</td>
        </tr>

        <!-- 데이터 행들 -->
        {% for item in items %}
            {% if item.isBlank %}
                <tr class="blank-row">
                    <td colspan="2" class="border-left"></td>
                    <td colspan="2"></td>
                    <td colspan="6"></td>
                    <td colspan="5"></td>
                    <td colspan="2"></td>
                    <td colspan="5"></td>
                    <td colspan="5"></td>
                    <td colspan="5"></td>
                    <td colspan="2" class="border-right"></td>
                </tr>
            {% elif item.isHeader %}
                <tr class="data-row bg-light">
                    <td colspan="2" class="text-center border-left">{% if item.month %}{{ item.month }}{% endif %}</td>
                    <td colspan="2" class="text-center">{% if item.day %}{{ item.day }}{% endif %}</td>
                    <td colspan="24" class="text-left border-right"><strong>{{ item.item_name }}</strong></td>
                </tr>
            {% else %}
                <tr class="data-row {% if item.item_name == 'NEGO' %}nego-row{% endif %}">
                    <td colspan="2" class="text-center border-left">{% if item.month and item.month != 0 %}{{ item.month }}{% endif %}</td>
                    <td colspan="2" class="text-center">{% if item.day and item.day != 0 %}{{ item.day }}{% endif %}</td>
                    <td colspan="6" class="text-left">{{ item.item_name }}</td>
                    <td colspan="5" class="text-left">{% if item.specification %}{{ item.specification }}{% endif %}</td>
                    <td colspan="2" class="text-right">{% if item.quantity and item.quantity != 0 %}{{ item.quantity }}{% endif %}</td>
                    <td colspan="5" class="text-right">{% if item.unit_price and item.unit_price != 0 %}{{ "{:,}".format(item.unit_price) }}{% endif %}</td>
                    <td colspan="5" class="text-right">
                        {% if item.total_price and item.total_price != 0 %}
                            {% if item.item_name == 'NEGO' and item.total_price > 0 %}-{% endif %}
                            {{ "{:,}".format(item.total_price|abs) }}
                        {% endif %}
                    </td>
                    <td colspan="5" class="text-right">
                        {% if item.vat and item.vat != 0 %}
                            {% if item.item_name == 'NEGO' and item.vat > 0 %}-{% endif %}
                            {{ "{:,}".format(item.vat|abs) }}
                        {% endif %}
                    </td>
                    <td colspan="2" class="text-center border-right"></td>
                </tr>
            {% endif %}
        {% endfor %}

        <!-- 합계 행 -->
        <tr class="total-row border-bottom">
            <td colspan="2" class="border-left border-bottom"></td>
            <td colspan="2" class="border-bottom"></td>
            <td colspan="6" class="border-bottom"></td>
            <td colspan="5" class="border-bottom"></td>
            <td colspan="2" class="border-bottom"></td>
            <td colspan="5" class="text-right border-bottom">합   계</td>
            <td colspan="5" class="text-right border-bottom">{{ "{:,}".format(total_supply) }}</td>
            <td colspan="5" class="text-right border-bottom">{{ "{:,}".format(total_vat) }}</td>
            <td colspan="2" class="text-center border-right border-bottom"></td>
        </tr>
    </table>
</body>
</html>
